<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liam Kelly">
<meta name="dcterms.date" content="2023-01-15">

<title>LaughingRook - Can Goals Scored In The English Premier Be Modelled By A Poisson Process?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">LaughingRook</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link active" data-scroll-target="#dependencies">Dependencies</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-pipeline" id="toc-data-pipeline" class="nav-link" data-scroll-target="#data-pipeline">Data Pipeline</a>
  <ul class="collapse">
  <li><a href="#clean-the-goal-timings" id="toc-clean-the-goal-timings" class="nav-link" data-scroll-target="#clean-the-goal-timings">Clean the goal timings</a></li>
  <li><a href="#season-goal-timings" id="toc-season-goal-timings" class="nav-link" data-scroll-target="#season-goal-timings">Season goal timings</a></li>
  <li><a href="#waiting-time-between-goals" id="toc-waiting-time-between-goals" class="nav-link" data-scroll-target="#waiting-time-between-goals">Waiting time between goals</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#number-of-goals-per-game" id="toc-number-of-goals-per-game" class="nav-link" data-scroll-target="#number-of-goals-per-game">Number of goals per game</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Can Goals Scored In The English Premier Be Modelled By A Poisson Process?</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">Probability</div>
    <div class="quarto-category">Visualisation</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liam Kelly </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Work in progress</p>
</div>
</div>
<section id="dependencies" class="level2">
<h2 class="anchored" data-anchor-id="dependencies">Dependencies</h2>
<p>We load the dependencies first so they are accessible throughout the entire notebook.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="im">as</span> st</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">from</span> seaborn <span class="im">import</span> objects <span class="im">as</span> so</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
</section>
<section id="data-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="data-pipeline">Data Pipeline</h2>
<p>Cache and load the CSV file into a <em>pandas</em> <code>DataFrame</code>.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/ljk233/laughingrook-datasets/main/epl_goals/epl_1819.csv'</span>  <span class="co"># noqa</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>epl_goals_df <span class="op">=</span> pd.read_csv(url, usecols<span class="op">=</span>[<span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">19</span>])</span>
<span id="cb2-3"><a href="#cb2-3"></a>epl_goals_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 380 entries, 0 to 379
Data columns (total 3 columns):
 #   Column                  Non-Null Count  Dtype 
---  ------                  --------------  ----- 
 0   total_goal_count        380 non-null    int64 
 1   home_team_goal_timings  292 non-null    object
 2   away_team_goal_timings  261 non-null    object
dtypes: int64(1), object(2)
memory usage: 9.0+ KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>epl_goals_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>total_goal_count</th>
      <th>home_team_goal_timings</th>
      <th>away_team_goal_timings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>3,83</td>
      <td>90'2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>11</td>
      <td>8,18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>24,90'1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>NaN</td>
      <td>41,79</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>NaN</td>
      <td>34,45,80</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="clean-the-goal-timings" class="level3">
<h3 class="anchored" data-anchor-id="clean-the-goal-timings">Clean the goal timings</h3>
<p>Each line represents the results of a single game, with the goal times stored as a comma-separated <code>str</code>. However, there are a number of issues with this, which this pipeline will fix.</p>
<ul>
<li><code>Lines #3 to #6</code> unpivots the data
<ul>
<li>The goal timings are stored in two columns, but ultimately they will be subjected to the same transformation</li>
<li>By unpivoting the data, we only need to transform a single column</li>
</ul></li>
<li><code>Line #7</code> resets the <em>index</em> and stores it in a column called <em>game_id</em>
<ul>
<li>There is a natural ordering to the data, which cannot be inferred once we start transforming it</li>
<li>By preserving the <em>index</em>, we can the infer this natural ordering later on</li>
</ul></li>
<li><code>Lines #8 to #11</code> processes the goal timings column
<ul>
<li><code>Line #8</code> splits the <em>goal timings</em> value, so each row is cast to a <code>list</code></li>
<li><code>Line #9</code> explodes the <em>goal timings</em>, so rather than each row holding data on multiple goals, now each row represents the time of an individual goal (as a <code>str</code>)</li>
<li><code>Lines #10 to #11</code> then casts the goal timings to an <code>int</code>, with a side-effect being that we drop any goals scored in injury time</li>
</ul></li>
<li><code>Lines #12 to #16</code> then finish the transformation
<ul>
<li><code>Line #12</code> sorts the date by <em>game id</em> &gt; <em>game time</em></li>
<li><code>Line #13</code> resets the <em>index</em></li>
<li><code>Line #14</code> resets the <em>index</em>, and renames it to <em>goal_id</em></li>
<li><code>Line #15</code> renames columns to something more sensible</li>
<li><code>Line #16</code> drops columns that are not needed in the future</li>
</ul></li>
</ul>
<p>This will be stored in a new view called <em>goal_timings_df</em>.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>goal_timings_df <span class="op">=</span> (</span>
<span id="cb5-2"><a href="#cb5-2"></a>    epl_goals_df</span>
<span id="cb5-3"><a href="#cb5-3"></a>    .melt(value_vars<span class="op">=</span>[<span class="st">'home_team_goal_timings'</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>                      <span class="st">'away_team_goal_timings'</span>],</span>
<span id="cb5-5"><a href="#cb5-5"></a>          ignore_index<span class="op">=</span><span class="va">False</span>,)</span>
<span id="cb5-6"><a href="#cb5-6"></a>    .dropna()</span>
<span id="cb5-7"><a href="#cb5-7"></a>    .reset_index().rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'game_id'</span>})</span>
<span id="cb5-8"><a href="#cb5-8"></a>    .assign(value<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'value'</span>].<span class="bu">str</span>.split(<span class="st">','</span>))</span>
<span id="cb5-9"><a href="#cb5-9"></a>    .explode(column<span class="op">=</span><span class="st">'value'</span>, ignore_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    .assign(value<span class="op">=</span><span class="kw">lambda</span> x: pd.to_numeric(x[<span class="st">'value'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>))</span>
<span id="cb5-11"><a href="#cb5-11"></a>    .dropna().assign(value<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'value'</span>].astype(<span class="bu">int</span>))</span>
<span id="cb5-12"><a href="#cb5-12"></a>    .sort_values(by<span class="op">=</span>[<span class="st">'game_id'</span>, <span class="st">'value'</span>])</span>
<span id="cb5-13"><a href="#cb5-13"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a>    .rename_axis(<span class="st">'goal_id'</span>).reset_index()</span>
<span id="cb5-15"><a href="#cb5-15"></a>    .rename(columns<span class="op">=</span>{<span class="st">'value'</span>: <span class="st">'game_min'</span>})</span>
<span id="cb5-16"><a href="#cb5-16"></a>    .drop(columns<span class="op">=</span>[<span class="st">'variable'</span>])</span>
<span id="cb5-17"><a href="#cb5-17"></a>)</span>
<span id="cb5-18"><a href="#cb5-18"></a>goal_timings_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 978 entries, 0 to 977
Data columns (total 3 columns):
 #   Column    Non-Null Count  Dtype
---  ------    --------------  -----
 0   goal_id   978 non-null    int64
 1   game_id   978 non-null    int64
 2   game_min  978 non-null    int32
dtypes: int32(1), int64(2)
memory usage: 19.2 KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>goal_timings_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>goal_id</th>
      <th>game_id</th>
      <th>game_min</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1</td>
      <td>8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="season-goal-timings" class="level3">
<h3 class="anchored" data-anchor-id="season-goal-timings">Season goal timings</h3>
<p>We will model the EPL season as if no games were played at the same time, instead as if they were played consecutively. We do this by shifting each <em>game_min</em> by 90 <span class="math inline">\(\times\)</span> <em>goal_id</em>. This representation is then stored in <em>season_min</em>.</p>
<p>We will hold this data in a new view called <em>season_goal_timing_df</em>.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>season_goal_timings_df <span class="op">=</span> (</span>
<span id="cb8-2"><a href="#cb8-2"></a>    goal_timings_df</span>
<span id="cb8-3"><a href="#cb8-3"></a>    .assign(start_min<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'game_id'</span>] <span class="op">*</span> <span class="dv">90</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>            season_min<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'start_min'</span>] <span class="op">+</span> x[<span class="st">'game_min'</span>])</span>
<span id="cb8-5"><a href="#cb8-5"></a>    .drop(columns<span class="op">=</span>[<span class="st">'game_min'</span>, <span class="st">'start_min'</span>])</span>
<span id="cb8-6"><a href="#cb8-6"></a>)</span>
<span id="cb8-7"><a href="#cb8-7"></a>season_goal_timings_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>goal_id</th>
      <th>game_id</th>
      <th>season_min</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>83</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1</td>
      <td>98</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>101</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
      <td>108</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="waiting-time-between-goals" class="level3">
<h3 class="anchored" data-anchor-id="waiting-time-between-goals">Waiting time between goals</h3>
<p>The calculate the time between each concecutive goals, and store this in a <code>DataFrame</code> called <em>waiting_time_between_goals_df</em>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>waiting_time_between_goals_df <span class="op">=</span> (</span>
<span id="cb9-2"><a href="#cb9-2"></a>    season_goal_timings_df</span>
<span id="cb9-3"><a href="#cb9-3"></a>    .assign(waiting_time<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'season_min'</span>].diff())</span>
<span id="cb9-4"><a href="#cb9-4"></a>    .dropna()</span>
<span id="cb9-5"><a href="#cb9-5"></a>    .assign(waiting_time<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'waiting_time'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb9-6"><a href="#cb9-6"></a>    .drop(columns<span class="op">=</span><span class="st">'season_min'</span>)</span>
<span id="cb9-7"><a href="#cb9-7"></a>)</span>
<span id="cb9-8"><a href="#cb9-8"></a>waiting_time_between_goals_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>goal_id</th>
      <th>game_id</th>
      <th>waiting_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>80</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1</td>
      <td>15</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>2</td>
      <td>96</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="number-of-goals-per-game" class="level3">
<h3 class="anchored" data-anchor-id="number-of-goals-per-game">Number of goals per game</h3>
<p>If goal scoring can be modelled by a Poisson process, then we would expect the number of goals per game to be distributed by a Poisson distribution with parameter <span class="math inline">\(\Bbb {E} (\text{number of goals per game})\)</span>.</p>
<p>There were on average approximately 2.8 goals per game, with variance approximately 2.5642. These are quite close, so there is evidence that the number of goals per game maybe modelled by a Poisson distribution with parameter approximately 2.8.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>(epl_goals_df[<span class="st">'total_goal_count'</span>].mean(),</span>
<span id="cb10-2"><a href="#cb10-2"></a> epl_goals_df[<span class="st">'total_goal_count'</span>].var())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>(2.8210526315789473, 2.5641994167476736)</code></pre>
</div>
</div>
<p>The plot below shows the observed frequency of each goal count, and the expected frquency if the number of goals per game could be modelled by a Poisson distribution.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>n_games <span class="op">=</span> epl_goals_df.shape[<span class="dv">0</span>]</span>
<span id="cb12-2"><a href="#cb12-2"></a>goal_rate <span class="op">=</span> epl_goals_df[[<span class="st">'total_goal_count'</span>]].mean()</span>
<span id="cb12-3"><a href="#cb12-3"></a>num_goals_model <span class="op">=</span> st.poisson(goal_rate)</span>
<span id="cb12-4"><a href="#cb12-4"></a>num_goals_per_game_df <span class="op">=</span> (</span>
<span id="cb12-5"><a href="#cb12-5"></a>    epl_goals_df[<span class="st">'total_goal_count'</span>]</span>
<span id="cb12-6"><a href="#cb12-6"></a>    .value_counts().rename_axis(<span class="st">'num_goals'</span>).rename(<span class="st">'observed'</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a>    .reset_index()</span>
<span id="cb12-8"><a href="#cb12-8"></a>    .assign(expected<span class="op">=</span><span class="kw">lambda</span> x: num_goals_model.pmf(x[<span class="st">'num_goals'</span>]) <span class="op">*</span> n_games)</span>
<span id="cb12-9"><a href="#cb12-9"></a>    .sort_values(by<span class="op">=</span><span class="st">'num_goals'</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>)</span>
<span id="cb12-11"><a href="#cb12-11"></a>(</span>
<span id="cb12-12"><a href="#cb12-12"></a>    so.Plot(data<span class="op">=</span>num_goals_per_game_df.melt(id_vars<span class="op">=</span><span class="st">'num_goals'</span>),</span>
<span id="cb12-13"><a href="#cb12-13"></a>            x<span class="op">=</span><span class="st">'num_goals'</span>,</span>
<span id="cb12-14"><a href="#cb12-14"></a>            y<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb12-15"><a href="#cb12-15"></a>            color<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a>    .add(so.Bar(), so.Dodge())</span>
<span id="cb12-17"><a href="#cb12-17"></a>    .label(x<span class="op">=</span><span class="st">'Number of goals'</span>,</span>
<span id="cb12-18"><a href="#cb12-18"></a>           y<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="20230115-epl_goals_poisson_process_files/figure-html/cell-10-output-1.png" width="725" height="445"></p>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="an">title:</span><span class="co"> Can Goals Scored In The English Premier Be Modelled By A Poisson Process?</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="an">date:</span><span class="co"> '2023-01-15'</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="an">categories:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">  - Probability</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">  - Visualisation</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="an">jupyter:</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">  jupytext:</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">    text_representation:</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">      extension: .qmd</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">      format_name: quarto</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">      format_version: '1.0'</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">      jupytext_version: 1.14.4</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">  kernelspec:</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">    display_name: lr_stats</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">    language: python</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">    name: lr_stats</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">---</span></span>
<span id="cb13-19"><a href="#cb13-19"></a></span>
<span id="cb13-20"><a href="#cb13-20"></a>:::{.callout-warning}</span>
<span id="cb13-21"><a href="#cb13-21"></a>Work in progress</span>
<span id="cb13-22"><a href="#cb13-22"></a>:::</span>
<span id="cb13-23"><a href="#cb13-23"></a></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="fu">## Dependencies</span></span>
<span id="cb13-25"><a href="#cb13-25"></a></span>
<span id="cb13-26"><a href="#cb13-26"></a>We load the dependencies first so they are accessible throughout the entire notebook.</span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="in">```{python}</span></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="im">as</span> st</span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="im">from</span> seaborn <span class="im">import</span> objects <span class="im">as</span> so</span>
<span id="cb13-35"><a href="#cb13-35"></a><span class="in">```</span></span>
<span id="cb13-36"><a href="#cb13-36"></a></span>
<span id="cb13-37"><a href="#cb13-37"></a><span class="fu">## Summary</span></span>
<span id="cb13-38"><a href="#cb13-38"></a></span>
<span id="cb13-39"><a href="#cb13-39"></a><span class="fu">## Introduction</span></span>
<span id="cb13-40"><a href="#cb13-40"></a></span>
<span id="cb13-41"><a href="#cb13-41"></a><span class="fu">## Data Pipeline</span></span>
<span id="cb13-42"><a href="#cb13-42"></a></span>
<span id="cb13-43"><a href="#cb13-43"></a>Cache and load the CSV file into a *pandas* <span class="in">`DataFrame`</span>.</span>
<span id="cb13-44"><a href="#cb13-44"></a></span>
<span id="cb13-47"><a href="#cb13-47"></a><span class="in">```{python}</span></span>
<span id="cb13-48"><a href="#cb13-48"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/ljk233/laughingrook-datasets/main/epl_goals/epl_1819.csv'</span>  <span class="co"># noqa</span></span>
<span id="cb13-49"><a href="#cb13-49"></a>epl_goals_df <span class="op">=</span> pd.read_csv(url, usecols<span class="op">=</span>[<span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">19</span>])</span>
<span id="cb13-50"><a href="#cb13-50"></a>epl_goals_df.info()</span>
<span id="cb13-51"><a href="#cb13-51"></a><span class="in">```</span></span>
<span id="cb13-52"><a href="#cb13-52"></a></span>
<span id="cb13-55"><a href="#cb13-55"></a><span class="in">```{python}</span></span>
<span id="cb13-56"><a href="#cb13-56"></a>epl_goals_df.head()</span>
<span id="cb13-57"><a href="#cb13-57"></a><span class="in">```</span></span>
<span id="cb13-58"><a href="#cb13-58"></a></span>
<span id="cb13-59"><a href="#cb13-59"></a><span class="fu">### Clean the goal timings</span></span>
<span id="cb13-60"><a href="#cb13-60"></a></span>
<span id="cb13-61"><a href="#cb13-61"></a>Each line represents the results of a single game, with the goal times stored as a comma-separated <span class="in">`str`</span>.</span>
<span id="cb13-62"><a href="#cb13-62"></a>However, there are a number of issues with this, which this pipeline will fix.</span>
<span id="cb13-63"><a href="#cb13-63"></a></span>
<span id="cb13-64"><a href="#cb13-64"></a><span class="ss">- </span><span class="in">`Lines #3 to #6`</span> unpivots the data</span>
<span id="cb13-65"><a href="#cb13-65"></a><span class="ss">  - </span>The goal timings are stored in two columns, but ultimately they will be subjected to the same transformation</span>
<span id="cb13-66"><a href="#cb13-66"></a><span class="ss">   - </span>By unpivoting the data, we only need to transform a single column</span>
<span id="cb13-67"><a href="#cb13-67"></a><span class="ss">- </span><span class="in">`Line #7`</span> resets the *index* and stores it in a column called *game_id*</span>
<span id="cb13-68"><a href="#cb13-68"></a><span class="ss">  - </span>There is a natural ordering to the data, which cannot be inferred once we start transforming it</span>
<span id="cb13-69"><a href="#cb13-69"></a><span class="ss">  - </span>By preserving the *index*, we can the infer this natural ordering later on</span>
<span id="cb13-70"><a href="#cb13-70"></a><span class="ss">- </span><span class="in">`Lines #8 to #11`</span> processes the goal timings column</span>
<span id="cb13-71"><a href="#cb13-71"></a><span class="ss">  - </span><span class="in">`Line #8`</span> splits the *goal timings* value, so each row is cast to a <span class="in">`list`</span></span>
<span id="cb13-72"><a href="#cb13-72"></a><span class="ss">  - </span><span class="in">`Line #9`</span> explodes the *goal timings*, so rather than each row holding data on multiple goals, now each row represents the time of an individual goal (as a <span class="in">`str`</span>)</span>
<span id="cb13-73"><a href="#cb13-73"></a><span class="ss">  - </span><span class="in">`Lines #10 to #11`</span> then casts the goal timings to an <span class="in">`int`</span>, with a side-effect being that we drop any goals scored in injury time</span>
<span id="cb13-74"><a href="#cb13-74"></a><span class="ss">- </span><span class="in">`Lines #12 to #16`</span> then finish the transformation</span>
<span id="cb13-75"><a href="#cb13-75"></a><span class="ss">  - </span><span class="in">`Line #12`</span> sorts the date by *game id* &gt; *game time*</span>
<span id="cb13-76"><a href="#cb13-76"></a><span class="ss">  - </span><span class="in">`Line #13`</span> resets the *index*</span>
<span id="cb13-77"><a href="#cb13-77"></a><span class="ss">  - </span><span class="in">`Line #14`</span> resets the *index*, and renames it to *goal_id*</span>
<span id="cb13-78"><a href="#cb13-78"></a><span class="ss">  - </span><span class="in">`Line #15`</span> renames columns to something more sensible</span>
<span id="cb13-79"><a href="#cb13-79"></a><span class="ss">  - </span><span class="in">`Line #16`</span> drops columns that are not needed in the future</span>
<span id="cb13-80"><a href="#cb13-80"></a></span>
<span id="cb13-81"><a href="#cb13-81"></a>This will be stored in a new view called *goal_timings_df*.</span>
<span id="cb13-82"><a href="#cb13-82"></a></span>
<span id="cb13-85"><a href="#cb13-85"></a><span class="in">```{python}</span></span>
<span id="cb13-86"><a href="#cb13-86"></a>goal_timings_df <span class="op">=</span> (</span>
<span id="cb13-87"><a href="#cb13-87"></a>    epl_goals_df</span>
<span id="cb13-88"><a href="#cb13-88"></a>    .melt(value_vars<span class="op">=</span>[<span class="st">'home_team_goal_timings'</span>,</span>
<span id="cb13-89"><a href="#cb13-89"></a>                      <span class="st">'away_team_goal_timings'</span>],</span>
<span id="cb13-90"><a href="#cb13-90"></a>          ignore_index<span class="op">=</span><span class="va">False</span>,)</span>
<span id="cb13-91"><a href="#cb13-91"></a>    .dropna()</span>
<span id="cb13-92"><a href="#cb13-92"></a>    .reset_index().rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'game_id'</span>})</span>
<span id="cb13-93"><a href="#cb13-93"></a>    .assign(value<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'value'</span>].<span class="bu">str</span>.split(<span class="st">','</span>))</span>
<span id="cb13-94"><a href="#cb13-94"></a>    .explode(column<span class="op">=</span><span class="st">'value'</span>, ignore_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-95"><a href="#cb13-95"></a>    .assign(value<span class="op">=</span><span class="kw">lambda</span> x: pd.to_numeric(x[<span class="st">'value'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>))</span>
<span id="cb13-96"><a href="#cb13-96"></a>    .dropna().assign(value<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'value'</span>].astype(<span class="bu">int</span>))</span>
<span id="cb13-97"><a href="#cb13-97"></a>    .sort_values(by<span class="op">=</span>[<span class="st">'game_id'</span>, <span class="st">'value'</span>])</span>
<span id="cb13-98"><a href="#cb13-98"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-99"><a href="#cb13-99"></a>    .rename_axis(<span class="st">'goal_id'</span>).reset_index()</span>
<span id="cb13-100"><a href="#cb13-100"></a>    .rename(columns<span class="op">=</span>{<span class="st">'value'</span>: <span class="st">'game_min'</span>})</span>
<span id="cb13-101"><a href="#cb13-101"></a>    .drop(columns<span class="op">=</span>[<span class="st">'variable'</span>])</span>
<span id="cb13-102"><a href="#cb13-102"></a>)</span>
<span id="cb13-103"><a href="#cb13-103"></a>goal_timings_df.info()</span>
<span id="cb13-104"><a href="#cb13-104"></a><span class="in">```</span></span>
<span id="cb13-105"><a href="#cb13-105"></a></span>
<span id="cb13-108"><a href="#cb13-108"></a><span class="in">```{python}</span></span>
<span id="cb13-109"><a href="#cb13-109"></a>goal_timings_df.head()</span>
<span id="cb13-110"><a href="#cb13-110"></a><span class="in">```</span></span>
<span id="cb13-111"><a href="#cb13-111"></a></span>
<span id="cb13-112"><a href="#cb13-112"></a><span class="fu">### Season goal timings</span></span>
<span id="cb13-113"><a href="#cb13-113"></a></span>
<span id="cb13-114"><a href="#cb13-114"></a>We will model the EPL season as if no games were played at the same time, instead as if they were played consecutively.</span>
<span id="cb13-115"><a href="#cb13-115"></a>We do this by shifting each *game_min* by 90 $\times$ *goal_id*.</span>
<span id="cb13-116"><a href="#cb13-116"></a>This representation is then stored in *season_min*.</span>
<span id="cb13-117"><a href="#cb13-117"></a></span>
<span id="cb13-118"><a href="#cb13-118"></a>We will hold this data in a new view called *season_goal_timing_df*.</span>
<span id="cb13-119"><a href="#cb13-119"></a></span>
<span id="cb13-122"><a href="#cb13-122"></a><span class="in">```{python}</span></span>
<span id="cb13-123"><a href="#cb13-123"></a>season_goal_timings_df <span class="op">=</span> (</span>
<span id="cb13-124"><a href="#cb13-124"></a>    goal_timings_df</span>
<span id="cb13-125"><a href="#cb13-125"></a>    .assign(start_min<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'game_id'</span>] <span class="op">*</span> <span class="dv">90</span>,</span>
<span id="cb13-126"><a href="#cb13-126"></a>            season_min<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'start_min'</span>] <span class="op">+</span> x[<span class="st">'game_min'</span>])</span>
<span id="cb13-127"><a href="#cb13-127"></a>    .drop(columns<span class="op">=</span>[<span class="st">'game_min'</span>, <span class="st">'start_min'</span>])</span>
<span id="cb13-128"><a href="#cb13-128"></a>)</span>
<span id="cb13-129"><a href="#cb13-129"></a>season_goal_timings_df.head()</span>
<span id="cb13-130"><a href="#cb13-130"></a><span class="in">```</span></span>
<span id="cb13-131"><a href="#cb13-131"></a></span>
<span id="cb13-132"><a href="#cb13-132"></a><span class="fu">### Waiting time between goals</span></span>
<span id="cb13-133"><a href="#cb13-133"></a></span>
<span id="cb13-134"><a href="#cb13-134"></a>The calculate the time between each concecutive goals, and store this in a <span class="in">`DataFrame`</span> called *waiting_time_between_goals_df*.</span>
<span id="cb13-135"><a href="#cb13-135"></a></span>
<span id="cb13-138"><a href="#cb13-138"></a><span class="in">```{python}</span></span>
<span id="cb13-139"><a href="#cb13-139"></a>waiting_time_between_goals_df <span class="op">=</span> (</span>
<span id="cb13-140"><a href="#cb13-140"></a>    season_goal_timings_df</span>
<span id="cb13-141"><a href="#cb13-141"></a>    .assign(waiting_time<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'season_min'</span>].diff())</span>
<span id="cb13-142"><a href="#cb13-142"></a>    .dropna()</span>
<span id="cb13-143"><a href="#cb13-143"></a>    .assign(waiting_time<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'waiting_time'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb13-144"><a href="#cb13-144"></a>    .drop(columns<span class="op">=</span><span class="st">'season_min'</span>)</span>
<span id="cb13-145"><a href="#cb13-145"></a>)</span>
<span id="cb13-146"><a href="#cb13-146"></a>waiting_time_between_goals_df.head()</span>
<span id="cb13-147"><a href="#cb13-147"></a><span class="in">```</span></span>
<span id="cb13-148"><a href="#cb13-148"></a></span>
<span id="cb13-149"><a href="#cb13-149"></a><span class="fu">## Analysis</span></span>
<span id="cb13-150"><a href="#cb13-150"></a></span>
<span id="cb13-151"><a href="#cb13-151"></a><span class="fu">### Number of goals per game</span></span>
<span id="cb13-152"><a href="#cb13-152"></a></span>
<span id="cb13-153"><a href="#cb13-153"></a>If goal scoring can be modelled by a Poisson process, then we would expect the number of goals per game to be distributed by a Poisson distribution with parameter $\Bbb {E} (\text{number of goals per game})$.</span>
<span id="cb13-154"><a href="#cb13-154"></a></span>
<span id="cb13-155"><a href="#cb13-155"></a>There were on average approximately 2.8 goals per game, with variance approximately 2.5642.</span>
<span id="cb13-156"><a href="#cb13-156"></a>These are quite close, so there is evidence that the number of goals per game maybe modelled by a Poisson distribution with parameter approximately 2.8.</span>
<span id="cb13-157"><a href="#cb13-157"></a></span>
<span id="cb13-160"><a href="#cb13-160"></a><span class="in">```{python}</span></span>
<span id="cb13-161"><a href="#cb13-161"></a>(epl_goals_df[<span class="st">'total_goal_count'</span>].mean(),</span>
<span id="cb13-162"><a href="#cb13-162"></a> epl_goals_df[<span class="st">'total_goal_count'</span>].var())</span>
<span id="cb13-163"><a href="#cb13-163"></a><span class="in">```</span></span>
<span id="cb13-164"><a href="#cb13-164"></a></span>
<span id="cb13-165"><a href="#cb13-165"></a>The plot below shows the observed frequency of each goal count, and the expected frquency if the number of goals per game could be modelled by a Poisson distribution.</span>
<span id="cb13-166"><a href="#cb13-166"></a></span>
<span id="cb13-169"><a href="#cb13-169"></a><span class="in">```{python}</span></span>
<span id="cb13-170"><a href="#cb13-170"></a>n_games <span class="op">=</span> epl_goals_df.shape[<span class="dv">0</span>]</span>
<span id="cb13-171"><a href="#cb13-171"></a>goal_rate <span class="op">=</span> epl_goals_df[[<span class="st">'total_goal_count'</span>]].mean()</span>
<span id="cb13-172"><a href="#cb13-172"></a>num_goals_model <span class="op">=</span> st.poisson(goal_rate)</span>
<span id="cb13-173"><a href="#cb13-173"></a>num_goals_per_game_df <span class="op">=</span> (</span>
<span id="cb13-174"><a href="#cb13-174"></a>    epl_goals_df[<span class="st">'total_goal_count'</span>]</span>
<span id="cb13-175"><a href="#cb13-175"></a>    .value_counts().rename_axis(<span class="st">'num_goals'</span>).rename(<span class="st">'observed'</span>)</span>
<span id="cb13-176"><a href="#cb13-176"></a>    .reset_index()</span>
<span id="cb13-177"><a href="#cb13-177"></a>    .assign(expected<span class="op">=</span><span class="kw">lambda</span> x: num_goals_model.pmf(x[<span class="st">'num_goals'</span>]) <span class="op">*</span> n_games)</span>
<span id="cb13-178"><a href="#cb13-178"></a>    .sort_values(by<span class="op">=</span><span class="st">'num_goals'</span>)</span>
<span id="cb13-179"><a href="#cb13-179"></a>)</span>
<span id="cb13-180"><a href="#cb13-180"></a>(</span>
<span id="cb13-181"><a href="#cb13-181"></a>    so.Plot(data<span class="op">=</span>num_goals_per_game_df.melt(id_vars<span class="op">=</span><span class="st">'num_goals'</span>),</span>
<span id="cb13-182"><a href="#cb13-182"></a>            x<span class="op">=</span><span class="st">'num_goals'</span>,</span>
<span id="cb13-183"><a href="#cb13-183"></a>            y<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb13-184"><a href="#cb13-184"></a>            color<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb13-185"><a href="#cb13-185"></a>    .add(so.Bar(), so.Dodge())</span>
<span id="cb13-186"><a href="#cb13-186"></a>    .label(x<span class="op">=</span><span class="st">'Number of goals'</span>,</span>
<span id="cb13-187"><a href="#cb13-187"></a>           y<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb13-188"><a href="#cb13-188"></a>)</span>
<span id="cb13-189"><a href="#cb13-189"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>